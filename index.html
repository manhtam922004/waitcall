<!DOCTYPE html>
<html>
<head>
  <title>Video Call với PeerJS</title>
</head>
<body>
  <!-- Video của bạn -->
  <video id="local-video" autoplay muted></video>
  <!-- Video của người kia -->
  <video id="remote-video" autoplay></video>

  <!-- Thêm thư viện PeerJS -->
  <script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>
  <!-- Thêm mã JavaScript của bạn -->
  <script>
    // Lấy video của bạn
    navigator.mediaDevices.getUserMedia({video: true, audio: true}).then(stream => {
      const localVideo = document.getElementById('local-video');
      localVideo.srcObject = stream;

      // Khởi tạo Peer
      const peer = new Peer(undefined, {
        host: '0.peerjs.com',
        port: 443,
        secure: true,
        config: {
          'iceServers': [
            { 'urls': 'stun:stun.l.google.com:19302' },
            { 'urls': 'stun:stun1.l.google.com:19302' }
          ]
        }
      });

      // Khi nhận ID từ PeerJS server
      peer.on('open', id => {
        console.log('My peer ID is: ' + id);
        // Chia sẻ ID này với người kia để họ có thể kết nối
      });

      // Trả lời cuộc gọi đến
      peer.on('call', call => {
        call.answer(stream);
        call.on('stream', remoteStream => {
          const remoteVideo = document.getElementById('remote-video');
          remoteVideo.srcObject = remoteStream;
        });
      });

      // Gọi đến người khác (sử dụng ID của họ)
      function callPeer(otherPeerId) {
        const call = peer.call(otherPeerId, stream);
        call.on('stream', remoteStream => {
          const remoteVideo = document.getElementById('remote-video');
          remoteVideo.srcObject = remoteStream;
        });
      }

      // Ví dụ gọi đến ID 'another-peer-id'
      // callPeer('another-peer-id');

    }).catch(error => {
      console.error('Lỗi khi truy cập camera/micro:', error);
    });
  </script>
</body>
</html>
